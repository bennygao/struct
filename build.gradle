group 'cc.devfun'
version = '1.0.1'

apply plugin: 'java'
sourceCompatibility = 1.7

def libPath = 'lib'
def targetArchive = "${project.name}-${version}.jar"

dependencies {
    compile files('lib/antlr-4.5.3-complete.jar')
    compile files('lib/velocity-1.7.jar')
    compile files('lib/velocity-1.7-dep.jar')
    compile files('lib/argparse4j-0.7.0.jar')
}

sourceSets {
    main {
        java {
            srcDirs = ['src/main/java']
        }
    }
}

jar {
    manifest {
        attributes 'Main-Class': 'cc.devfun.struct.compiler.StructCompiler'
        attributes 'Class-Path': new File(libPath).list().findAll {
            it.endsWith('.jar') }.collect { "$libPath/$it" }.join(' ')
    }

    archiveName = targetArchive

    // 把项目依赖的所有jar也打包进发布的jar包中。
    from { 
		configurations.compile.collect { 
			it.isDirectory() ? it : zipTree(it) 
		}
	}
}
